<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="">
<meta name="author" content="">

<title>New HMTL document by NewJect</title>
    <style>
        .axis path,
        .axis line{
            fill: none;
            stroke: black;
            shape-rendering: crispEdges;
        }

        .axis text {
            font-family: sans-serif;
            font-size: 11px;
        }

        .canvas {
            border: 1px solid #ccc;
            border-radius: 5px;
            margin: 5px;
        }

        .link {
            fill: none;
            stroke: #ccc;
        }
    </style>
<script src="d3.js"></script>
</head>
<body>
<div id="datetime"></div>
<div>


<h3>this is new html document generated by newject extention</h3>
    <h3></h3>
    <h3></h3>
</div>

    <script>
        var vflag = 1;
        d3.select('#datetime')
            .text(function() {return new Date;})
            .append('p')
                .text('version: ' + vflag);

        ////////////////////////////////////////////////////////////////////////
        var cw = 500, ch = 500;
        function makeCanvas(name, transCenter) {
            var svg = d3.select('body')
                    .append('svg')
                    .attr('class', 'canvas')
                    .attr({width: cw, height: ch});
            svg.append('text')
                .attr('class', 'canvas-legend')
                .attr('alignment-baseline', 'before-edge')
                .attr('dx', 10)
                .attr('dy', 10)
                .text(name);

            var canvas = svg.append('g');
            if (transCenter) {
                canvas.attr('transform', 'translate(' + cw / 2 + ',' + ch / 2 + ')');
            }
            return canvas;
        }
        //////////////////////////////////////////////////////////////////

        var data = ['a', 'b', 'c', 'd', 'e', 'f'];
        var h = d3.select('body').selectAll('h3').data(data);
        h.text(function(d, i) {
            return d + '' + i;
        });

        h.enter().append('h3').text(function(d, i) {
            return d + '' + i;
        });

        /////////////////////////////////////////////////////////////////
        data = [20, 35, 32, 12, 22];

        var linear = d3.scale.linear()
                    .domain([0, d3.max(data)])
                    .range([0, 490]);

        var axis = d3.svg.axis()
                    .scale(linear)
                    .orient('bottom')
                    .ticks(10);

        var rh = 30;
        var svg = d3.select('body')
                .insert('svg', '#datetime')
                .attr('width', 500)
                .attr('height', 300)
                .append('g')
                    .attr('transform', 'translate(5, 0)');

        svg.selectAll('rect')
            .data(data)
            .enter()
                .append('rect')
                .attr('x', 0)
                .attr('y', function(d, i) { return i * rh})
                .attr('height', rh - 2)
                .attr('width', 0)
                .attr('fill', 'steelblue')
                .on('mouseover', function () {
                    d3.select(this).attr('fill', 'red');
                })
                .on('mouseout', function () {
                    d3.select(this)
                        .transition()
                        .duration(500)
                        .attr('fill', 'steelblue');
                })
                .transition()
                    .duration(2000)
                    .delay(function(d, i) {return i * 200})
                    .ease('bounce')
                    .attr('width', function (d, i) { return linear(d)})

        // 生成坐标轴
        svg.append('g')
            .attr('class', 'axis')
            .attr('transform', 'translate(0, ' + (data.length * rh + 5) + ')')
            .call(axis);


        ////////////////////////////////////////////////////////////////////////////////
        // 布局

        // 饼图
        var canvas = makeCanvas('饼图');

        var pie = d3.layout.pie();
        var piedata = pie(data);
        var outerRadius = 150;
        var innerRadius = 50;
        var color = d3.scale.category10();

        var arc = d3.svg.arc() // 弧度生成器
                    .innerRadius(innerRadius)  // 内半径
                    .outerRadius(outerRadius); // 外半径

        var arcs = canvas.selectAll('g')
            .data(piedata)
            .enter()
                .append('g')
                .attr('transform', 'translate(250, 250)');

        arcs.append('path')
            .attr('fill', function (d, i) { return color(i); })
            .attr('d', arc);

        arcs.append('text')
            .attr('transform', function (d) {
                return 'translate(' + arc.centroid(d) + ')';
            })
            .attr('text-anchor', 'middle')
            .text(function (d) { return d.data; });


        //////////////////////////////////////////////////////////////////////////////////////////////
        // 弦图
        var city_name = [ "北京" , "上海" , "广州" , "深圳" , "香港"  ];

        var population = [
          [ 1000,  3045　 , 4567　, 1234 , 3714 ],
          [ 3214,  2000　 , 2060　, 124  , 3234 ],
          [ 8761,  6545　 , 3000　, 8045 , 647  ],
          [ 3211,  1067  , 3214 , 4000  , 1006 ],
          [ 2146,  1034　 , 6745 , 4764  , 5000 ]
        ];

        // 布局
        var chord = d3.layout.chord()
                .padding(0.01) // 节点间隔
                .sortSubgroups(d3.descending)
                .matrix(population);

        var groups = chord.groups();
        var chords = chord.chords();

        var innerRadius = cw / 2 * 0.6;
        var outerRadius = innerRadius * 1.1;
        var arc = d3.svg.arc()
                .innerRadius(innerRadius)
                .outerRadius(outerRadius);

        canvas = makeCanvas('弦图')
                .attr('transform', 'translate(' + cw/2 + ',' + ch/2 + ')');

        var nodes = canvas.selectAll('g.node')
            .data(groups)
            .enter()
          .append('g')
            .attr('class', 'node');

        // 节点
        nodes.append('path')
            .attr('fill', function (d) {return color(d.index); })
            .attr('d', arc);

        // 文字
        nodes.append('text')
            .attr('text-anchor', 'middle')
            .attr('alignment-baseline', 'middle')
            .attr('font-size', 14)
            .attr('transform', function (d) {
                // arc在创建弧度时会默认有一个负90度的偏转以实现从顶部开始
                var angle = (d.startAngle + d.endAngle) / 2,
                    degree = angle * 180 / Math.PI,
                    dr = outerRadius + 20;

//                        return ['translate(', arc.centroid(d),  ')'].join('');
                return ['rotate(', degree, ')',
                        'translate(', 0, ',', -dr, ')',
                        degree - 90 > 0 && degree - 90 < 180 ? 'rotate(180)' : ''
                       ].join('');
            })
            .text(function (d, i) { return city_name[i];});

        // 连线
        var chord_edge = d3.svg.chord().radius(innerRadius);

        canvas.selectAll('path.chord')
            .data(chords)
            .enter()
            .append('path')
            .attr('class', 'chord')
            .attr('d', chord_edge)
            .attr('fill', function(d) { return color(d.source.index);})
            .attr('opacity', 0.7)
            .on('mouseover', function (d, i) {
                d3.select(this)
                    .attr('fill', 'yellow');
            })
            .on('mouseout', function (d, i) {
                d3.select(this)
                    .transition()
                    .duration(500)
                    .attr('fill', color(d.source.index));
        })

        /////////////////////////////////////////////////////////////////////////////////////////////////

        /**
         * 集群图
         */

        canvas = makeCanvas('集群图', true);

        var cluster = d3.layout.cluster()
                .size([2 * Math.PI, cw / 2 * 0.7]);

        function paintCluster (data) {
            var nodes = cluster.nodes(data);
            var links = cluster.links(nodes);

            // 对角贝塞尔曲线
            var diagonal = d3.svg.diagonal()
                    .projection(function (d) {
                        return [d.y * Math.cos(d.x),
                                d.y * Math.sin(d.x)]
                    }); // 调换x、y，使图垂直显示

            canvas.selectAll('.link')
                .data(links)
                .enter()
                .append('path')
                    .attr('class', 'link')
                    .attr('d', diagonal);

            var nodes = canvas.selectAll('.node')
                .data(nodes)
                .enter()
                .append('g')
                    .attr('transform', function (d) { return 'translate(' + diagonal.projection()(d) + ')'})
                    .attr('class', 'node')
                    .attr('fill', 'white')
                    .attr('stroke', 'steelblue')
                    .attr('strokeWidth', 2);

            nodes.append('circle')
                    .attr('r', 5);

            nodes.append('text')
                .attr('alignment-baseline', 'middle')
                .attr('text-anchor', function (d) { return Math.cos(d.x) >= 0 ? 'start' : 'end'})
                .attr('dx', function (d) { return Math.cos(d.x) >= 0 ? 10 : -10})
                .attr('transform', function (d) {
                    return [
                        'rotate(', d.x * 180 / Math.PI + (Math.cos(d.x) >= 0 ? 0 : 180), ')',
                    ].join(' ');
                })
                .text(function (d) { return d.name});
        }

        // 加载数据
        d3.json('city2.json', function(err, data) {
            if (err) console.log(err);
            else paintCluster(data);
        })

        ///////////////////////////////////////////////////////////////////////////////////////////////

    </script>
    <script src="layouts/pack.js"></script>



    <!-- ---------------------------------------------------------------------- -->
    <script>
        d3.select('body').append('h5').text('~~end/////////////////////////////');
    </script>
</body>
</html>
